<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ludus Forest Build Animation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #111827;
        }
        .domain-col {
            border: 2px solid #374151;
            box-shadow: 0 0 25px rgba(30, 58, 138, 0.3);
            transition: all 0.5s ease-in-out;
        }
        .vm-box {
            transition: all 0.5s ease-in-out;
            border-width: 2px;
            position: relative;
            overflow: hidden;
        }
        .vm-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: all 0.7s;
        }
        .building::before {
            left: 100%;
        }
        .pending {
            background-color: #374151;
            border-color: #4b5563;
            color: #d1d5db;
        }
        .building {
            background-color: #1e3a8a;
            border-color: #3b82f6;
            color: #eff6ff;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
        }
        .ready {
            background-color: #064e3b;
            border-color: #10b981;
            color: #d1fae5;
        }
        .line {
            stroke-width: 2.5;
            stroke-dasharray: 6;
            animation: dash 3s linear infinite;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }
        @keyframes dash {
            to {
                stroke-dashoffset: 100;
            }
        }
        .domain-title {
            text-shadow: 0 0 10px currentColor;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8 flex flex-col items-center justify-center min-h-screen">

    <div class="w-full max-w-7xl">
        <div class="text-center mb-12">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-100">Ludus Forest Build Simulation</h1>
            <p class="text-gray-400 mt-2">Visualizing the deployment based on `depends_on` clauses.</p>
        </div>

        <div id="visualization" class="relative w-full">
            <!-- Parent Domain (Top of Triangle) -->
            <div class="flex justify-center mb-16">
                <div class="domain-col w-full md:w-3/5 lg:w-2/5 space-y-4 rounded-lg p-4">
                    <h2 class="text-xl font-semibold text-center text-sky-400 domain-title">parent.local (VLAN 10)</h2>
                    <div id="PARENT-DC1" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">PARENT-DC1</h3><p class="text-sm status">Pending...</p></div>
                    <div id="PARENT-DC2" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">PARENT-DC2</h3><p class="text-sm status">Pending...</p></div>
                    <div id="PARENT-WEB1" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">PARENT-WEB1</h3><p class="text-sm status">Pending...</p></div>
                    <div id="PARENT-WKS1" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">PARENT-WKS1</h3><p class="text-sm status">Pending...</p></div>
                </div>
            </div>

            <!-- Child Domains (Bottom of Triangle) -->
            <div class="flex flex-col md:flex-row justify-around gap-8">
                <div class="domain-col w-full md:w-2/5 space-y-4 rounded-lg p-4">
                    <h2 class="text-xl font-semibold text-center text-amber-400 domain-title">child1.parent.local (VLAN 20)</h2>
                    <div id="CHILD1-DC1" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">CHILD1-DC1</h3><p class="text-sm status">Pending...</p></div>
                    <div id="CHILD1-MAIL1" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">CHILD1-MAIL1</h3><p class="text-sm status">Pending...</p></div>
                    <div id="CHILD1-WKS1" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">CHILD1-WKS1</h3><p class="text-sm status">Pending...</p></div>
                    <div id="CHILD1-WKS2" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">CHILD1-WKS2</h3><p class="text-sm status">Pending...</p></div>
                    <div id="CHILD1-WKS3" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">CHILD1-WKS3</h3><p class="text-sm status">Pending...</p></div>
                    <div id="CHILD1-WKS4" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">CHILD1-WKS4</h3><p class="text-sm status">Pending...</p></div>
                </div>
                <div class="domain-col w-full md:w-2/5 space-y-4 rounded-lg p-4">
                    <h2 class="text-xl font-semibold text-center text-emerald-400 domain-title">child2.parent.local (VLAN 30)</h2>
                    <div id="CHILD2-DC1" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">CHILD2-DC1</h3><p class="text-sm status">Pending...</p></div>
                    <div id="CHILD2-DC2" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">CHILD2-DC2</h3><p class="text-sm status">Pending...</p></div>
                    <div id="CHILD2-FS1" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">CHILD2-FS1</h3><p class="text-sm status">Pending...</p></div>
                    <div id="CHILD2-WKS1" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">CHILD2-WKS1</h3><p class="text-sm status">Pending...</p></div>
                    <div id="CHILD2-WKS2" class="vm-box p-3 rounded-lg pending"><h3 class="font-bold">CHILD2-WKS2</h3><p class="text-sm status">Pending...</p></div>
                </div>
            </div>
            <svg id="svg-canvas" class="absolute top-0 left-0 w-full h-full pointer-events-none"></svg>
        </div>

        <div class="text-center mt-12">
            <button id="replayBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition-transform hover:scale-105">
                Restart Animation
            </button>
        </div>
    </div>

    <script>
        const vms = [
            'PARENT-DC1', 'PARENT-DC2', 'PARENT-WEB1', 'PARENT-WKS1',
            'CHILD1-DC1', 'CHILD1-MAIL1', 'CHILD1-WKS1', 'CHILD1-WKS2', 'CHILD1-WKS3', 'CHILD1-WKS4',
            'CHILD2-DC1', 'CHILD2-DC2', 'CHILD2-FS1', 'CHILD2-WKS1', 'CHILD2-WKS2'
        ];
        let animationLines = [];
        let isAnimating = false;

        function getElementCenter(id) {
            const el = document.getElementById(id);
            if (!el) return { x: 0, y: 0 };
            const rect = el.getBoundingClientRect();
            const containerRect = document.getElementById('visualization').getBoundingClientRect();
            return {
                x: rect.left + rect.width / 2 - containerRect.left,
                y: rect.top + rect.height / 2 - containerRect.top
            };
        }

        function drawLine(fromId, toId, color = '#6b7280') {
            const svg = document.getElementById('svg-canvas');
            const from = getElementCenter(fromId);
            const to = getElementCenter(toId);

            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', from.x);
            line.setAttribute('y1', from.y);
            line.setAttribute('x2', to.x);
            line.setAttribute('y2', to.y);
            line.setAttribute('class', 'line');
            line.style.stroke = color;
            svg.appendChild(line);
            animationLines.push({fromId, toId, line, color});
            
            void line.offsetWidth;

            setTimeout(() => {
                line.style.opacity = 0.7;
            }, 100);
        }
        
        function redrawLines() {
             const svg = document.getElementById('svg-canvas');
             svg.innerHTML = '';
             const currentLines = [...animationLines];
             animationLines = [];
             currentLines.forEach(l => drawLine(l.fromId, l.toId, l.color));
        }

        function updateVmStatus(id, status, className) {
            const vm = document.getElementById(id);
            if (!vm) return;
            vm.querySelector('.status').textContent = status;
            vm.classList.remove('pending', 'building', 'ready');
            vm.classList.add(className);
        }
        
        const sleep = ms => new Promise(res => setTimeout(res, ms));

        async function runAnimation() {
            if (isAnimating) return;
            isAnimating = true;
            document.getElementById('replayBtn').disabled = true;
            
            document.getElementById('svg-canvas').innerHTML = '';
            animationLines = [];
            vms.forEach(id => updateVmStatus(id, 'Pending...', 'pending'));
            await sleep(1000);

            updateVmStatus('PARENT-DC1', 'Building: Native primary-dc...', 'building');
            updateVmStatus('PARENT-DC2', 'Building: Native alt-dc...', 'building');
            updateVmStatus('PARENT-WEB1', 'Building: Native member...', 'building');
            updateVmStatus('PARENT-WKS1', 'Building: Native member...', 'building');
            await sleep(3500);

            updateVmStatus('PARENT-DC1', 'Role: ludus_verify_dc_ready...', 'building');
            updateVmStatus('PARENT-DC2', 'Ready', 'ready');
            updateVmStatus('PARENT-WEB1', 'Ready', 'ready');
            updateVmStatus('PARENT-WKS1', 'Ready', 'ready');
            await sleep(2500);
            
            updateVmStatus('PARENT-DC1', 'Ready', 'ready');
            await sleep(1000);

            drawLine('PARENT-DC1', 'CHILD1-DC1', '#f59e0b');
            drawLine('PARENT-DC1', 'CHILD2-DC1', '#10b981');
            updateVmStatus('CHILD1-DC1', 'Role: ludus_create_child_domain...', 'building');
            updateVmStatus('CHILD2-DC1', 'Role: ludus_create_child_domain...', 'building');
            await sleep(4000);

            updateVmStatus('CHILD1-DC1', 'Ready', 'ready');
            updateVmStatus('CHILD2-DC1', 'Ready', 'ready');
            await sleep(1000);

            drawLine('CHILD1-DC1', 'CHILD1-MAIL1', '#f59e0b');
            drawLine('CHILD1-DC1', 'CHILD1-WKS1', '#f59e0b');
            drawLine('CHILD1-DC1', 'CHILD1-WKS2', '#f59e0b');
            drawLine('CHILD1-DC1', 'CHILD1-WKS3', '#f59e0b');
            drawLine('CHILD1-DC1', 'CHILD1-WKS4', '#f59e0b');
            drawLine('CHILD2-DC1', 'CHILD2-DC2', '#10b981');
            drawLine('CHILD2-DC1', 'CHILD2-FS1', '#10b981');
            drawLine('CHILD2-DC1', 'CHILD2-WKS1', '#10b981');
            drawLine('CHILD2-DC1', 'CHILD2-WKS2', '#10b981');
            
            updateVmStatus('CHILD1-MAIL1', 'Role: ludus_join_child_domain...', 'building');
            updateVmStatus('CHILD1-WKS1', 'Role: ludus_join_child_domain...', 'building');
            updateVmStatus('CHILD1-WKS2', 'Role: ludus_join_child_domain...', 'building');
            updateVmStatus('CHILD1-WKS3', 'Role: ludus_join_child_domain...', 'building');
            updateVmStatus('CHILD1-WKS4', 'Role: ludus_join_child_domain...', 'building');
            updateVmStatus('CHILD2-DC2', 'Role: ludus_secondary_child_dc...', 'building');
            updateVmStatus('CHILD2-FS1', 'Role: ludus_join_child_domain...', 'building');
            updateVmStatus('CHILD2-WKS1', 'Role: ludus_join_child_domain...', 'building');
            updateVmStatus('CHILD2-WKS2', 'Role: ludus_join_child_domain...', 'building');
            await sleep(4000);

            updateVmStatus('CHILD1-MAIL1', 'Ready', 'ready');
            updateVmStatus('CHILD1-WKS1', 'Ready', 'ready');
            updateVmStatus('CHILD1-WKS2', 'Ready', 'ready');
            updateVmStatus('CHILD1-WKS3', 'Ready', 'ready');
            updateVmStatus('CHILD1-WKS4', 'Ready', 'ready');
            updateVmStatus('CHILD2-DC2', 'Ready', 'ready');
            updateVmStatus('CHILD2-FS1', 'Ready', 'ready');
            updateVmStatus('CHILD2-WKS1', 'Ready', 'ready');
            updateVmStatus('CHILD2-WKS2', 'Ready', 'ready');
            
            isAnimating = false;
            document.getElementById('replayBtn').disabled = false;
            
            await sleep(5000);
            runAnimation();
        }

        document.getElementById('replayBtn').addEventListener('click', runAnimation);
        
        let resizeTimeout;
        window.addEventListener('resize', () => {
             clearTimeout(resizeTimeout);
             resizeTimeout = setTimeout(redrawLines, 100);
        });

        runAnimation();
    </script>
</body>
</html>
